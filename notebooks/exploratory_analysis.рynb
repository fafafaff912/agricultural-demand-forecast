# Исследовательский анализ временного ряда производства молока
## Цель: визуализация, проверка стационарности, выявление сезонности и тренда
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from darts.datasets import MilkDataset
from darts.utils.statistics import plot_acf, check_seasonality
from statsmodels.tsa.seasonal import seasonal_decompose
from statsmodels.tsa.stattools import adfuller

# Загрузка данных
series = MilkDataset().load()
print(f"Длина ряда: {len(series)}")
print(f"Период: {series.time_index[0]} - {series.time_index[-1]}")

# Базовый график
series.plot(label='Производство молока')
plt.title('Исходный временной ряд')
plt.grid()
plt.show()
## 2. Декомпозиция ряда на тренд, сезонность и остатки
# Преобразуем в pandas Series для декомпозиции
values = series.pd_series()

# Декомпозиция (аддитивная модель, период 12 месяцев)
decomposition = seasonal_decompose(values, model='additive', period=12)
fig = decomposition.plot()
fig.set_size_inches(12, 8)
plt.show()
Из графика декомпозиции видно:
- **Тренд**: устойчивый рост на всём промежутке.
- **Сезонность**: ярко выраженная годовая цикличность.
- **Остатки**: случайный шум, в основном стационарный.
## 3. Проверка стационарности (ADF-тест)
adf_result = adfuller(values)
print(f"ADF Statistic: {adf_result[0]:.4f}")
print(f"p-value: {adf_result[1]:.4f}")
if adf_result[1] < 0.05:
    print("Ряд стационарен (отвергаем H0)")
else:
    print("Ряд нестационарен, требуется дифференцирование")
p-value > 0.05, значит ряд нестационарен. Для модели ARIMA потребуется дифференцирование.
## 4. Автокорреляция и частичная автокорреляция
from darts.utils.statistics import plot_acf, plot_pacf

plot_acf(series, m=12, max_lag=24, fig_size=(10, 5))
plot_pacf(series, m=12, max_lag=24, fig_size=(10, 5))
plt.show()
На графиках ACF и PACF видны значимые пики на лагах, кратных 12, что подтверждает годовую сезонность.
## 5. Быстрое сравнение моделей (запуск main.py)
# Можно выполнить команду прямо из ноутбука
!python ../src/main.py
## 6. Выводы
- Ряд имеет выраженный тренд и сезонность.
- N-BEATS, благодаря способности автоматически извлекать такие компоненты, показывает лучшее качество прогноза по сравнению с ARIMA.
- Полученные метрики MAPE и SMAPE подтверждают эффективность нейросетевого подхода.
